#!/usr/bin/env python3

import sys
import os
import json

# add src load packages
sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

from src.lib import Args
from src.lib import Connection

_args = Args(sys.argv)
CONNECT_USER = _args.get('-u', default="test")
CONNECT_PASS = _args.get('-p', default="test")
CONNECT_HOST = _args.get('-h', default="0.0.0.0")

try:
    con = Connection(CONNECT_USER, CONNECT_PASS, host=CONNECT_HOST)

    while True:
        _command = input("> ")
        if _command == 'quit':
            break

        __command = _command.split(" ", 2)

        data = None
        command = None
        if len(__command) == 2:
            command, data = __command
        else:
            command = __command[0]

        res = json.loads(con.pool(command, data=data), encoding='utf8')

        if res['error']:
            print(">> ERROR: %s" % res['response'])
        else:
            print(">> %s" % res['response'])

    con.close()
except Exception as e:
    print("Unable to connect %s@%s" % (CONNECT_USER, CONNECT_HOST))
